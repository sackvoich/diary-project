{% extends "diary/base.html" %}
{% load static %}
{% load diary_tags %}

{% block title %}–õ–∏—á–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫{% endblock %}

{% block content %}
    <div class="diary-container">
        <h1>–ú–æ–∏ –∑–∞–ø–∏—Å–∏</h1>
        <form method="POST" class="entry-form" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                {{ form.content.label_tag }}
                {{ form.content }}
            </div>
            <div class="form-group privacy-setting">
                {{ form.is_public }}
                {{ form.is_public.label_tag }}
            </div>
            <div class="form-group">
                {{ form.attachment.label_tag }}
                {{ form.attachment }}
            </div>
            <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
        </form>

        <ul class="entries-list">
            {% for entry in entries %}
                <li class="entry-item {% if entry.is_public %}public{% endif %}" data-entry-id="{{ entry.id }}">
                    <span class="edit-url" style="display:none;" data-url="{% url 'edit_entry' entry_id=entry.id %}"></span>
                    <div class="entry-content">
                        <p class="content-text" style="display: block;">{{ entry.content }}</p>
                        <textarea class="edit-textarea" style="display: none;">{{ entry.content }}</textarea>
                    </div>

                    {% if entry.attachment %}
                        {% if entry.attachment and entry.attachment.url|is_image %}
                            <img src="{{ entry.attachment.url }}" ... >
                        {% elif entry.attachment and entry.attachment.url|slice:"-4:" == ".pdf" %}
                            <p><a href="{{ entry.attachment.url }}" ... >–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å PDF</a></p>
                        {% elif entry.attachment %}
                            <p><a href="{{ entry.attachment.url }}" ... >{{ entry.attachment.name }}</a></p>
                        {% endif %}
                    {% endif %}

                    <div class="entry-meta">
                        <span class="date">{{ entry.date_created|date:"d.m.Y H:i" }}</span>
                        <div class="entry-status">
                            <span class="privacy-status">
                                {% if entry.is_public %}
                                    üåç –ü—É–±–ª–∏—á–Ω–∞—è
                                {% else %}
                                    üîí –ü—Ä–∏–≤–∞—Ç–Ω–∞—è
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    <div class="entry-actions">
                        <button type="button" class="edit-btn" onclick="toggleEdit(this)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button type="button" class="save-btn" style="display: none;" onclick="saveEntry(this)">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="cancel-btn" style="display: none;" onclick="cancelEdit(this)">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å</button>
                        <button type="button" class="delete-btn" onclick="deleteEntry(this)">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </li>
            {% empty %}
                <li class="no-entries">
                    <div class="empty-state">
                        <span class="empty-icon">üìù</span>
                        <p>–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å!</p>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'diary/script.js' %}"></script>
{% endblock %}